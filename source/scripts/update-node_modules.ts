'use strict'

import { spawn } from 'child_process'
import * as semver from 'semver'
import * as debug from 'debug'

debug.enable('*')

const log = debug('scripts/update-node_modules.ts')
const process = spawn('npm', ['outdated', '--json'])

process.stdout.on('data', data => {

  const JSONString = data.toString()
  const outdated = JSON.parse(JSONString)

  for (const moduleName in outdated) {

    const { current, latest } = outdated[moduleName]

    // Only update if the current is not more recent than latest
    if (semver.gt(current, latest)) {
      log(`Skipping update of ${moduleName}`)
      continue
    }

    const updateProcess = spawn('npm', ['install', `${moduleName}@latest`, '--save'])

  }

})